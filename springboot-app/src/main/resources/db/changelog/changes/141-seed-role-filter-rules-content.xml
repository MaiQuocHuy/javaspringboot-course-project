<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="141-seed-role-filter-rules-content" author="system">
        <comment>Seed role filter rules for content resources: review, category, comment, video_content</comment>

        <!-- ============= REVIEW PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all reviews -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-043"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="review:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-044"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="review:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-045"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="review:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-046"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="review:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Read all published reviews, update/delete own reviews -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-047"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="review:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-048"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="review:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-049"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="review:UPDATE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-050"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="review:DELETE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Create reviews, read published reviews, manage own reviews -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-051"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="review:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-052"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="review:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-053"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="review:UPDATE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-054"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="review:DELETE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= CATEGORY PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all categories -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-055"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="category:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-056"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="category:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-057"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="category:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-058"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="category:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Read all categories (for course creation) -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-059"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="category:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Read all categories (for browsing) -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-060"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="category:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= COMMENT PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all comments -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-061"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="comment:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-062"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="comment:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-063"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="comment:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-064"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="comment:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Create comments, read published comments, manage own comments -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-065"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="comment:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-066"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="comment:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-067"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="comment:UPDATE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-068"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="comment:DELETE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Create comments, read published comments, manage own comments -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-069"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="comment:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-070"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="comment:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-071"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="comment:UPDATE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-072"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="comment:DELETE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= VIDEO_CONTENT PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all video content -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-073"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="video_content:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-074"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="video_content:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-075"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="video_content:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-076"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="video_content:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Manage own video content, read published content -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-077"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="video_content:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-078"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="video_content:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-079"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="video_content:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-080"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="video_content:UPDATE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-081"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="video_content:DELETE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Read published video content only -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-082"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="video_content:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <rollback>
            <delete tableName="role_filter_rules">
                <where>id IN ('rfr-043', 'rfr-044', 'rfr-045', 'rfr-046', 'rfr-047', 'rfr-048', 'rfr-049', 'rfr-050', 'rfr-051', 'rfr-052', 'rfr-053', 'rfr-054', 'rfr-055', 'rfr-056', 'rfr-057', 'rfr-058', 'rfr-059', 'rfr-060', 'rfr-061', 'rfr-062', 'rfr-063', 'rfr-064', 'rfr-065', 'rfr-066', 'rfr-067', 'rfr-068', 'rfr-069', 'rfr-070', 'rfr-071', 'rfr-072', 'rfr-073', 'rfr-074', 'rfr-075', 'rfr-076', 'rfr-077', 'rfr-078', 'rfr-079', 'rfr-080', 'rfr-081', 'rfr-082')</where>
            </delete>
        </rollback>
    </changeSet>

</databaseChangeLog>
