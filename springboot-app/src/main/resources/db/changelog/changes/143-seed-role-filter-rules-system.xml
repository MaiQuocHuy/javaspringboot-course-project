<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="143-seed-role-filter-rules-system" author="system">
        <comment>Seed role filter rules for system resources: refund, quiz_question, quiz_result, lesson_completion, lesson_type, system_log</comment>

        <!-- ============= REFUND PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all refunds -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-109"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="refund:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-110"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="refund:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-111"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="refund:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-112"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="refund:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Create refunds, read own refunds -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-113"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="refund:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-114"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="refund:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= QUIZ_QUESTION PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all quiz questions -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-115"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-116"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-117"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-118"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Manage quiz questions for own courses -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-119"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-120"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-121"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:UPDATE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-122"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:DELETE"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Read quiz questions for enrolled courses only -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-123"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="quiz_question:READ"/>
            <column name="filter_type" value="PUBLISHED_ONLY"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= QUIZ_RESULT PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all quiz results -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-124"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-125"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-126"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-127"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Read quiz results for own courses -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-128"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Create and read own quiz results -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-129"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-130"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="quiz_result:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= LESSON_COMPLETION PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all lesson completions -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-131"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-132"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-133"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-134"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Read lesson completions for own courses -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-135"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Create and read own lesson completions -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-136"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-137"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="lesson_completion:READ"/>
            <column name="filter_type" value="OWN"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= LESSON_TYPE PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all lesson types -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-138"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_type:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-139"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_type:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-140"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_type:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-141"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="lesson_type:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- INSTRUCTOR: Read lesson types (for course creation) -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-142"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'INSTRUCTOR' LIMIT 1)"/>
            <column name="permission_key" value="lesson_type:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- STUDENT: Read lesson types (for understanding course content) -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-143"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'STUDENT' LIMIT 1)"/>
            <column name="permission_key" value="lesson_type:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <!-- ============= SYSTEM_LOG PERMISSIONS ============= -->
        <!-- ADMIN: Full access to all system logs -->
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-144"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="system_log:CREATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-145"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="system_log:READ"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-146"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="system_log:UPDATE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>
        <insert tableName="role_filter_rules">
            <column name="id" value="rfr-147"/>
            <column name="role_id" valueComputed="(SELECT id FROM user_roles WHERE role = 'ADMIN' LIMIT 1)"/>
            <column name="permission_key" value="system_log:DELETE"/>
            <column name="filter_type" value="ALL"/>
            <column name="is_active" valueBoolean="true"/>
        </insert>

        <rollback>
            <delete tableName="role_filter_rules">
                <where>id IN ('rfr-109', 'rfr-110', 'rfr-111', 'rfr-112', 'rfr-113', 'rfr-114', 'rfr-115', 'rfr-116', 'rfr-117', 'rfr-118', 'rfr-119', 'rfr-120', 'rfr-121', 'rfr-122', 'rfr-123', 'rfr-124', 'rfr-125', 'rfr-126', 'rfr-127', 'rfr-128', 'rfr-129', 'rfr-130', 'rfr-131', 'rfr-132', 'rfr-133', 'rfr-134', 'rfr-135', 'rfr-136', 'rfr-137', 'rfr-138', 'rfr-139', 'rfr-140', 'rfr-141', 'rfr-142', 'rfr-143', 'rfr-144', 'rfr-145', 'rfr-146', 'rfr-147')</where>
            </delete>
        </rollback>
    </changeSet>

</databaseChangeLog>
