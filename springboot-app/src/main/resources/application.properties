spring.application.name=springboot-app
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Tắt Hibernate auto-update nếu đang bật
spring.jpa.hibernate.ddl-auto=none

# Liquibase config
spring.liquibase.change-log=classpath:/db/changelog/db.changelog-master.xml
spring.liquibase.enabled=true

# ======================
# Redis Configuration (Spring Boot 3.x format)
# ======================
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6380}
spring.data.redis.password=${REDIS_PASSWORD:123456789}
spring.data.redis.timeout=2000ms
spring.data.redis.database=0

# Redis Lettuce Connection Pool Configuration
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=-1ms
spring.data.redis.lettuce.shutdown-timeout=100ms

# Cache Configuration
spring.cache.type=redis
spring.cache.redis.time-to-live=600000
spring.cache.redis.cache-null-values=false
spring.cache.redis.use-key-prefix=true
spring.cache.redis.key-prefix=ktc-cache:

# Swagger config

## Customize Swagger UI path (optional, default is /swagger-ui.html)
springdoc.swagger-ui.path=/swagger-ui.html

## Enable Swagger UI
springdoc.swagger-ui.enabled=true

## Customize API docs path (optional, default is /v3/api-docs)
springdoc.api-docs.path=/api-docs

## Group APIs (optional)
springdoc.group-configs[0].group=public
springdoc.group-configs[0].paths-to-match=/api/**

## Disable Swagger UI in production (optional)
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.operations-sorter=alpha

## Ensure Swagger UI resources are properly served
springdoc.swagger-ui.use-root-path=true
springdoc.swagger-ui.disable-swagger-default-url=true

# Persistence configuration
springdoc.swagger-ui.persist-authorization=true

# JWT config
jwt.jwt-secret=${JWT_SECRET:4f8b3a2e7d9c1a6b5e8f2d4c9a1b3e6f7a2d5c8b1e4f7a2d5c8b1e4f7a2d5c8b}
jwt.jwt-expiration-ms=${JWT_EXPIRATION:1800000}
jwt.refresh-expiration=${REFRESH_EXPIRATION:}

# AOP/Proxy configuration - Enable CGLIB proxy for better event listener support
spring.aop.proxy-target-class=true

# Certificate PDF generation configuration
certificate.wkhtmltopdf.path=D:\\wkhtmltopdf\\bin\\wkhtmltopdf.exe
certificate.temp.directory=${java.io.tmpdir}/certificates

# Logging configuration for debugging
logging.level.org.springframework.web=DEBUG
logging.level.project.ktc.springboot_app=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.cache=DEBUG
logging.level.org.springframework.data.redis=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

# Cloudinary configuration (add default values for testing)
cloudinary.cloudName=${CLOUDINARY_CLOUD_NAME:test-cloud}
cloudinary.apiKey=${CLOUDINARY_API_KEY:test-key}
cloudinary.apiSecret=${CLOUDINARY_API_SECRET:test-secret}

# File Upload Configuration
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.file-size-threshold=2KB

# Stripe configuration
stripe.secretKey=${STRIPE_SECRET_KEY}
stripe.publishableKey=${STRIPE_PUBLISHABLE_KEY}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:whsec_b4e2013550f31e11536d5ce872ee7f270a6ac2a425d1bc1bd51845678b4a1118}

# Frontend URL for redirects
app.frontend.url=${FRONTEND_URL:http://localhost:3000}

# Affiliate Commission Configuration
app.affiliate.commission.percent=${AFFILIATE_COMMISSION_PERCENT:3.0}
app.affiliate.commission.enabled=${AFFILIATE_COMMISSION_ENABLED:true}

# ======================
# Email Service Configuration
# ======================

app.email.provider.primary=smtp
app.email.provider.fallback=smtp
app.email.provider.enableFallback=true

# SMTP Settings
app.email.smtp.host=${EMAIL_SMTP_HOST:localhost}
app.email.smtp.port=${EMAIL_SMTP_PORT:587}
app.email.smtp.username=${EMAIL_SMTP_USERNAME:}
app.email.smtp.password=${EMAIL_SMTP_PASSWORD:}
app.email.smtp.tls=${EMAIL_SMTP_TLS:true}
app.email.smtp.ssl=${EMAIL_SMTP_SSL:false}
app.email.smtp.auth=${EMAIL_SMTP_AUTH:true}
app.email.smtp.from=${EMAIL_FROM:noreply@ktc-learning.com}
app.email.smtp.fromName=${EMAIL_FROM_NAME:KTC Learning Platform}
app.email.smtp.connectionTimeout=${EMAIL_SMTP_CONNECTION_TIMEOUT:10000}
app.email.smtp.readTimeout=${EMAIL_SMTP_READ_TIMEOUT:10000}

# SendGrid Settings
app.email.sendgrid.apiKey=${SENDGRID_API_KEY:}
app.email.sendgrid.from=${EMAIL_FROM:noreply@ktc-learning.com}
app.email.sendgrid.fromName=${EMAIL_FROM_NAME:KTC Learning Platform}
app.email.sendgrid.defaultTemplateId=${SENDGRID_DEFAULT_TEMPLATE_ID:}
app.email.sendgrid.clickTracking=${SENDGRID_CLICK_TRACKING:true}
app.email.sendgrid.openTracking=${SENDGRID_OPEN_TRACKING:true}

# Retry Settings
app.email.retry.maxAttempts=${EMAIL_RETRY_MAX_ATTEMPTS:3}
app.email.retry.initialDelay=${EMAIL_RETRY_INITIAL_DELAY:60}
app.email.retry.maxDelay=${EMAIL_RETRY_MAX_DELAY:3600}
app.email.retry.backoffMultiplier=${EMAIL_RETRY_BACKOFF_MULTIPLIER:2.0}
app.email.retry.exponentialBackoff=${EMAIL_RETRY_EXPONENTIAL_BACKOFF:true}

# Template Settings
app.email.template.basePath=classpath:templates/email
app.email.template.encoding=UTF-8
app.email.template.cache=${EMAIL_TEMPLATE_CACHE:true}
app.email.template.cacheDuration=${EMAIL_TEMPLATE_CACHE_DURATION:3600}

# ======================
# Spring Boot Settings
# ======================

# Spring Mail Configuration
spring.mail.host=${EMAIL_SMTP_HOST:localhost}
spring.mail.port=${EMAIL_SMTP_PORT:587}
spring.mail.username=${EMAIL_SMTP_USERNAME:}
spring.mail.password=${EMAIL_SMTP_PASSWORD:}
spring.mail.properties.mail.smtp.auth=${EMAIL_SMTP_AUTH:true}
spring.mail.properties.mail.smtp.starttls.enable=${EMAIL_SMTP_TLS:true}
spring.mail.properties.mail.smtp.ssl.enable=${EMAIL_SMTP_SSL:false}
spring.mail.properties.mail.smtp.connectiontimeout=${EMAIL_SMTP_CONNECTION_TIMEOUT:10000}
spring.mail.properties.mail.smtp.timeout=${EMAIL_SMTP_READ_TIMEOUT:10000}
spring.mail.properties.mail.smtp.writetimeout=${EMAIL_SMTP_READ_TIMEOUT:10000}

# Async Configuration
spring.task.execution.pool.core-size=2
spring.task.execution.pool.max-size=10
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=email-async-

# Certificate PDF Generation API
certificate.pdf.api.url=http://localhost:1234/html-to-pdf
